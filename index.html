<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anglais Master - 3 Formes Compl√®tes</title>
    <style>
        :root { --primary: #6366f1; --bg: #f8fafc; --text: #1e293b; --warning: #f59e0b; --danger: #ef4444; --success: #22c55e; --fav: #ec4899; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 600px; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin-top: 10px; }
        .tabs { display: flex; background: #f1f5f9; border-bottom: 1px solid #e2e8f0; }
        .tab { flex: 1; padding: 15px; border: none; background: none; cursor: pointer; font-weight: bold; color: #64748b; }
        .tab.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: white; }
        .content { padding: 15px; display: none; }
        .content.active { display: block; }

        /* Vitesse Audio */
        .speed-control { background: #f1f5f9; padding: 10px; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 0.8rem; font-weight: bold; }
        .speed-control input { flex: 1; height: 5px; accent-color: var(--primary); }

        .verb-card { background: #f1f5f9; padding: 20px; border-radius: 15px; margin-bottom: 15px; text-align: center; border: 1px solid #e2e8f0; }
        .quiz-modes { display: flex; gap: 5px; margin-bottom: 15px; }
        .mode-btn { flex: 1; font-size: 0.7rem; padding: 8px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; background: white; font-weight: bold; }
        .mode-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        input[type="text"] { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #cbd5e1; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        .btn-check { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 15px; }
        .btn-act { padding: 10px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 0.75rem; color: white; }
        
        /* Liste de r√©vision am√©lior√©e pour voir les 3 temps */
        .list-container { max-height: 450px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; }
        .verb-header { display: grid; grid-template-columns: 35px 1fr 3fr 40px; padding: 10px; background: #f8fafc; font-weight: bold; font-size: 0.75rem; border-bottom: 2px solid #eee; position: sticky; top: 0; }
        .verb-item { display: grid; grid-template-columns: 35px 1fr 3fr 40px; padding: 12px 10px; border-bottom: 1px solid #f1f5f9; align-items: center; font-size: 0.82rem; }
        .verb-forms { display: flex; flex-wrap: wrap; gap: 4px; color: #475569; }
        .verb-forms b { color: var(--primary); }
        .hard-verb { background: #fffbeb !important; }
        .btn-fav { background: none; border: none; cursor: pointer; font-size: 1.1rem; filter: grayscale(1); transition: 0.2s; padding: 0; }
        .btn-fav.is-fav { filter: grayscale(0); }
        .audio-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; }
        #feedback { margin-top: 10px; text-align: center; font-weight: bold; min-height: 40px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="tabs">
        <button class="tab active" onclick="openTab('quiz', this)">QUIZ</button>
        <button class="tab" onclick="openTab('revision', this)">R√âVISION</button>
    </div>

    <div id="quiz" class="content active">
        <div class="quiz-modes">
            <button class="mode-btn active" onclick="setQuizMode('all', this)">Tous</button>
            <button class="mode-btn" onclick="setQuizMode('hard', this)">‚ö†Ô∏è Erreurs</button>
            <button class="mode-btn" onclick="setQuizMode('fav', this)">‚≠ê Favoris</button>
        </div>
        <div class="verb-card">
            <h2 id="q-fr">-</h2>
            <p>Base : <strong id="q-inf">-</strong></p>
        </div>
        <input type="text" id="input-pre" placeholder="Pr√©t√©rit (2√®me colonne)" autocomplete="off">
        <input type="text" id="input-par" placeholder="Participe Pass√© (3√®me colonne)" autocomplete="off">
        <button class="btn-check" onclick="checkAnswer()">V√©rifier</button>
        <div id="feedback"></div>
    </div>

    <div id="revision" class="content">
        <div class="speed-control">
            <span>üê¢ Vitesse</span>
            <input type="range" id="speedRange" min="0.3" max="1.3" step="0.1" value="0.8">
            <span id="speedVal">0.8x</span>
        </div>

        <div class="action-btns">
            <button class="btn-act" style="background: var(--warning)" onclick="toggleShowHard()">Priorit√©s ‚ö†Ô∏è</button>
            <button class="btn-act" style="background: #64748b" onclick="resetAll()">Reset ‚öôÔ∏è</button>
            <button class="btn-act" style="background: var(--primary)" onclick="playFullList(false)">Lecture Normale üîä</button>
            <button class="btn-act" style="background: #8b5cf6" onclick="playFullList(true)">Al√©atoire üîÄ</button>
        </div>
        
        <input type="text" id="search" placeholder="Chercher un verbe..." onkeyup="renderRevision()">
        
        <div class="list-container">
            <div class="verb-header">
                <span></span><span>FR</span><span>Anglais (Inf / Pr√©t / P.P)</span><span></span>
            </div>
            <div id="list-revision"></div>
        </div>
    </div>
</div>

<script>
    const verbes = [
        { fr: "√ätre", inf: "be", pre: "was", par: "been" }, { fr: "Porter", inf: "bear", pre: "bore", par: "borne" },
        { fr: "Battre", inf: "beat", pre: "beat", par: "beaten" }, { fr: "Devenir", inf: "become", pre: "became", par: "become" },
        { fr: "Commencer", inf: "begin", pre: "began", par: "begun" }, { fr: "Parier", inf: "bet", pre: "bet", par: "bet" },
        { fr: "Mordre", inf: "bite", pre: "bit", par: "bitten" }, { fr: "Saigner", inf: "bleed", pre: "bled", par: "bled" },
        { fr: "Souffler", inf: "blow", pre: "blew", par: "blown" }, { fr: "Casser", inf: "break", pre: "broke", par: "broken" },
        { fr: "Apporter", inf: "bring", pre: "brought", par: "brought" }, { fr: "Construire", inf: "build", pre: "built", par: "built" },
        { fr: "Br√ªler", inf: "burn", pre: "burnt", par: "burnt" }, { fr: "Acheter", inf: "buy", pre: "bought", par: "bought" },
        { fr: "Attraper", inf: "catch", pre: "caught", par: "caught" }, { fr: "Choisir", inf: "choose", pre: "chose", par: "chosen" },
        { fr: "Venir", inf: "come", pre: "came", par: "come" }, { fr: "Co√ªter", inf: "cost", pre: "cost", par: "cost" },
        { fr: "Couper", inf: "cut", pre: "cut", par: "cut" }, { fr: "Faire", inf: "do", pre: "did", par: "done" },
        { fr: "Dessiner", inf: "draw", pre: "drew", par: "drawn" }, { fr: "R√™ver", inf: "dream", pre: "dreamt", par: "dreamt" },
        { fr: "Boire", inf: "drink", pre: "drank", par: "drunk" }, { fr: "Conduire", inf: "drive", pre: "drove", par: "driven" },
        { fr: "Manger", inf: "eat", pre: "ate", par: "eaten" }, { fr: "Tomber", inf: "fall", pre: "fell", par: "fallen" },
        { fr: "Nourrir", inf: "feed", pre: "fed", par: "fed" }, { fr: "Ressentir", inf: "feel", pre: "felt", par: "felt" },
        { fr: "Se battre", inf: "fight", pre: "fought", par: "fought" }, { fr: "Trouver", inf: "find", pre: "found", par: "found" },
        { fr: "Voler (air)", inf: "fly", pre: "flew", par: "flown" }, { fr: "Oublier", inf: "forget", pre: "forgot", par: "forgotten" },
        { fr: "Pardonner", inf: "forgive", pre: "forgave", par: "forgiven" }, { fr: "Geler", inf: "freeze", pre: "froze", par: "frozen" },
        { fr: "Obtenir", inf: "get", pre: "got", par: "got" }, { fr: "Donner", inf: "give", pre: "gave", par: "given" },
        { fr: "Aller", inf: "go", pre: "went", par: "gone" }, { fr: "Grandir", inf: "grow", pre: "grew", par: "grown" },
        { fr: "Accrocher", inf: "hang", pre: "hung", par: "hung" }, { fr: "Avoir", inf: "have", pre: "had", par: "had" },
        { fr: "Entendre", inf: "hear", pre: "heard", par: "heard" }, { fr: "Cacher", inf: "hide", pre: "hid", par: "hidden" },
        { fr: "Frapper", inf: "hit", pre: "hit", par: "hit" }, { fr: "Tenir", inf: "hold", pre: "held", par: "held" },
        { fr: "Blesser", inf: "hurt", pre: "hurt", par: "hurt" }, { fr: "Garder", inf: "keep", pre: "kept", par: "kept" },
        { fr: "Savoir", inf: "know", pre: "knew", par: "known" }, { fr: "Poser", inf: "lay", pre: "laid", par: "laid" },
        { fr: "Mener", inf: "lead", pre: "led", par: "led" }, { fr: "Apprendre", inf: "learn", pre: "learnt", par: "learnt" },
        { fr: "Quitter", inf: "leave", pre: "left", par: "left" }, { fr: "Pr√™ter", inf: "lend", pre: "lent", par: "lent" },
        { fr: "Laisser", inf: "let", pre: "let", par: "let" }, { fr: "Perdre", inf: "lose", pre: "lost", par: "lost" },
        { fr: "Fabriquer", inf: "make", pre: "made", par: "made" }, { fr: "Signifier", inf: "mean", pre: "meant", par: "meant" },
        { fr: "Rencontrer", inf: "meet", pre: "met", par: "met" }, { fr: "Payer", inf: "pay", pre: "paid", par: "paid" },
        { fr: "Mettre", inf: "put", pre: "put", par: "put" }, { fr: "Lire", inf: "read", pre: "read", par: "read" },
        { fr: "Monter", inf: "ride", pre: "rode", par: "ridden" }, { fr: "Sonner", inf: "ring", pre: "rang", par: "rung" },
        { fr: "Courir", inf: "run", pre: "ran", par: "run" }, { fr: "Dire", inf: "say", pre: "said", par: "said" },
        { fr: "Voir", inf: "see", pre: "saw", par: "seen" }, { fr: "Vendre", inf: "sell", pre: "sold", par: "sold" },
        { fr: "Envoyer", inf: "send", pre: "sent", par: "sent" }, { fr: "Secouer", inf: "shake", pre: "shook", par: "shaken" },
        { fr: "Montrer", inf: "show", pre: "showed", par: "shown" }, { fr: "Chanter", inf: "sing", pre: "sang", par: "sung" },
        { fr: "S'asseoir", inf: "sit", pre: "sat", par: "sat" }, { fr: "Dormir", inf: "sleep", pre: "slept", par: "slept" },
        { fr: "Parler", inf: "speak", pre: "spoke", par: "spoken" }, { fr: "D√©penser", inf: "spend", pre: "spent", par: "spent" },
        { fr: "Se tenir", inf: "stand", pre: "stood", par: "stood" }, { fr: "Voler", inf: "steal", pre: "stole", par: "stolen" },
        { fr: "Nager", inf: "swim", pre: "swam", par: "swum" }, { fr: "Prendre", inf: "take", pre: "took", par: "taken" },
        { fr: "Enseigner", inf: "teach", pre: "taught", par: "taught" }, { fr: "Raconter", inf: "tell", pre: "told", par: "told" },
        { fr: "Penser", inf: "think", pre: "thought", par: "thought" }, { fr: "Lancer", inf: "throw", pre: "threw", par: "thrown" },
        { fr: "Comprendre", inf: "understand", pre: "understood", par: "understood" }, { fr: "R√©veiller", inf: "wake", pre: "woke", par: "woken" },
        { fr: "Porter", inf: "wear", pre: "wore", par: "worn" }, { fr: "Gagner", inf: "win", pre: "won", par: "won" },
        { fr: "√âcrire", inf: "write", pre: "wrote", par: "written" }
    ];

    let currentIdx = 0, quizMode = 'all', showHardOnly = false;
    let erreursData = JSON.parse(localStorage.getItem('erreursData')) || {};
    let favoris = JSON.parse(localStorage.getItem('favoris')) || [];

    const range = document.getElementById('speedRange');
    range.oninput = () => document.getElementById('speedVal').innerText = range.value + "x";

    function speak(text, callback) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        msg.rate = parseFloat(range.value);
        if(callback) msg.onend = callback;
        window.speechSynthesis.speak(msg);
    }

    function playFullList(shuffle) {
        let list = verbes;
        const search = document.getElementById('search').value.toLowerCase();
        if(search) list = list.filter(v => v.fr.toLowerCase().includes(search));
        if(showHardOnly) list = list.filter(v => (erreursData[v.inf] || 0) >= 2);
        if(shuffle) list = [...list].sort(() => Math.random() - 0.5);
        
        let i = 0;
        function play() {
            if(i < list.length) {
                speak(`${list[i].fr} : ${list[i].inf}, ${list[i].pre}, ${list[i].par}`, () => {
                    i++; setTimeout(play, 600);
                });
            }
        }
        play();
    }

    function openTab(tabId, el) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        el.classList.add('active');
        if(tabId === 'revision') renderRevision();
    }

    function toggleFav(inf) {
        if(favoris.includes(inf)) favoris = favoris.filter(f => f !== inf);
        else favoris.push(inf);
        localStorage.setItem('favoris', JSON.stringify(favoris));
        renderRevision();
    }

    function checkAnswer() {
        const p = document.getElementById('input-pre').value.toLowerCase().trim();
        const pp = document.getElementById('input-par').value.toLowerCase().trim();
        const v = verbes[currentIdx];
        if (p === v.pre && pp === v.par) {
            speak(`${v.inf}, ${v.pre}, ${v.par}`);
            if (erreursData[v.inf] > 0) {
                erreursData[v.inf] -= 1;
                localStorage.setItem('erreursData', JSON.stringify(erreursData));
            }
            document.getElementById('feedback').innerHTML = "<span style='color:var(--success)'>‚úÖ Correct !</span>";
            setTimeout(nextQuestion, 1200);
        } else {
            document.getElementById('feedback').innerHTML = `<span style='color:var(--danger)'>‚ùå Erreur : ${v.pre} | ${v.par}</span>`;
            erreursData[v.inf] = (erreursData[v.inf] || 0) + 1;
            localStorage.setItem('erreursData', JSON.stringify(erreursData));
        }
    }

    function renderRevision() {
        const container = document.getElementById('list-revision');
        const search = document.getElementById('search').value.toLowerCase();
        let list = verbes.filter(v => v.fr.toLowerCase().includes(search) || v.inf.toLowerCase().includes(search));
        if(showHardOnly) list = list.filter(v => (erreursData[v.inf] || 0) >= 2);

        container.innerHTML = list.map(v => {
            const isFav = favoris.includes(v.inf);
            return `
                <div class="verb-item ${(erreursData[v.inf] || 0) >= 2 ? 'hard-verb' : ''}">
                    <button class="btn-fav ${isFav ? 'is-fav' : ''}" onclick="toggleFav('${v.inf}')">‚≠ê</button>
                    <span>${v.fr}</span>
                    <div class="verb-forms">
                        <b>${v.inf}</b> / ${v.pre} / ${v.par}
                    </div>
                    <button class="audio-btn" onclick="speak('${v.inf}, ${v.pre}, ${v.par}')">üîä</button>
                </div>
            `;
        }).join('');
    }

    function nextQuestion() {
        let pool = verbes;
        if(quizMode === 'hard') pool = verbes.filter(v => (erreursData[v.inf] || 0) >= 2);
        if(quizMode === 'fav') pool = verbes.filter(v => favoris.includes(v.inf));
        if(pool.length === 0) return document.getElementById('q-fr').innerText = "Liste vide";
        
        currentIdx = verbes.indexOf(pool[Math.floor(Math.random() * pool.length)]);
        document.getElementById('q-fr').innerText = verbes[currentIdx].fr;
        document.getElementById('q-inf').innerText = verbes[currentIdx].inf;
        document.getElementById('input-pre').value = "";
        document.getElementById('input-par').value = "";
        document.getElementById('feedback').innerText = "";
    }

    function setQuizMode(m, b) {
        quizMode = m;
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        b.classList.add('active');
        nextQuestion();
    }

    function toggleShowHard() { showHardOnly = !showHardOnly; renderRevision(); }
    function resetAll() { if(confirm("Effacer tout ?")) { localStorage.clear(); location.reload(); } }

    nextQuestion();
</script>

</body>
</html>
